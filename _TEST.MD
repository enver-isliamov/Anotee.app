
# üß™ Anotee Testing Documentation

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ —á–µ–∫-–ª–∏—Å—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Anotee.
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏–∫–∏ –∏ API, –ø–ª—é—Å —Å—Ç—Ä–æ–≥–æ–µ —Ä—É—á–Ω–æ–µ/—Å–∫—Ä–∏–ø—Ç–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.

---

## 1. –°—Ç–µ–∫ –∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

*   **Unit Testing:** `Vitest` (—Å–æ–≤–º–µ—Å—Ç–∏–º —Å Vite, –±—ã—Å—Ç—Ä–µ–µ Jest).
*   **E2E Testing:** `Playwright` (–ª—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Safari/WebKit –¥–ª—è –≤–∏–¥–µ–æ).
*   **API Testing:** `Postman` –∏–ª–∏ `Hoppscotch` (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ Serverless —Ñ—É–Ω–∫—Ü–∏–π).
*   **Environment:** –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ —Å—Ä–µ–¥–µ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–π –∫ Vercel (Node 18+).

---

## 2. –ú–æ–¥—É–ª—å–Ω–æ–µ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Unit Testing)
*–¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å—Ç—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç —Å–µ—Ç–∏/–ë–î.*

### üõ† –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è

#### 1. –°–µ—Ä–≤–∏—Å –≠–∫—Å–ø–æ—Ä—Ç–∞ (`services/exportService.ts`)
–≠—Ç–æ **—Å–∞–º—ã–π –∫—Ä–∏—Ç–∏—á–Ω—ã–π** –º–æ–¥—É–ª—å –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –û—à–∏–±–∫–∞ –∑–¥–µ—Å—å –ª–æ–º–∞–µ—Ç –ø–æ—Å—Ç-–ø—Ä–æ–¥–∞–∫—à–Ω.
*   **EDL Generation:**
    *   –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (TITLE, FCM).
    *   –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á–µ—Ç IN/OUT —Ç–æ—á–µ–∫ –¥–ª—è 24, 25, 30, 60 FPS.
    *   –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `Range Comment` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∞ `Point Marker` –∏–º–µ–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (1 –∫–∞–¥—Ä).
*   **XML Generation (DaVinci):**
    *   –í–∞–ª–∏–¥–∞—Ü–∏—è XML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Ç–µ–≥–∏ –∑–∞–∫—Ä—ã—Ç—ã).
    *   –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Ü–≤–µ—Ç–æ–≤ (`resolved` -> Green, `open` -> Red).
    *   –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.

#### 2. –£—Ç–∏–ª–∏—Ç—ã –¢–∞–π–º–∫–æ–¥–æ–≤ (`services/utils.ts`)
*   **Math Check:** `formatTimecode(seconds)` –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `HH:MM:SS:FF`.
    *   *Case:* 1.5 —Å–µ–∫ –ø—Ä–∏ 30 FPS -> `00:00:01:15`.
    *   *Case:* –ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É/—á–∞—Å.
    *   *Anti-Drift:* –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –ø–ª–∞–≤–∞—é—â–µ–π –∑–∞–ø—è—Ç–æ–π (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Math.round` –∏–ª–∏ `epsilon`).

#### 3. –ü–∞—Ä—Å–∏–Ω–≥ –ú–µ–¥–∏–∞
*   `extractAudioFromUrl`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ `Content-Length`.
*   –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤.

---

## 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Backend API)
*–¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∫–∞ Serverless —Ñ—É–Ω–∫—Ü–∏–π –≤ –∏–∑–æ–ª—è—Ü–∏–∏.*

### üîê Permissions & ACL (`api/_permissions.js`)
–°–∞–º–∞—è –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
*   **–°—Ü–µ–Ω–∞—Ä–∏–π 1 (Owner):** –ú–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å, –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
*   **–°—Ü–µ–Ω–∞—Ä–∏–π 2 (Team Member):** –ú–æ–∂–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ø—Ä–æ–µ–∫—Ç.
*   **–°—Ü–µ–Ω–∞—Ä–∏–π 3 (Restricted Guest):**
    *   –ó–∞–ø—Ä–æ—Å `/api/data?projectId=X&assetId=Y`.
    *   *Expect:* –í –æ—Ç–≤–µ—Ç–µ –º–∞—Å—Å–∏–≤ `assets` —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û 1 —ç–ª–µ–º–µ–Ω—Ç. –ú–∞—Å—Å–∏–≤ `team` –ø—É—Å—Ç–æ–π –∏–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω.
*   **–°—Ü–µ–Ω–∞—Ä–∏–π 4 (Public Access):**
    *   –ï—Å–ª–∏ `publicAccess: 'none'` -> *Expect:* 403 Forbidden.
    *   –ï—Å–ª–∏ `publicAccess: 'view'` -> *Expect:* 200 OK (Read Only).

### ‚òÅÔ∏è Storage API (`api/storage.js`)
*   **Presigning:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫ AWS S3 (–Ω–∞–ª–∏—á–∏–µ `Signature` –≤ query params).
*   **Secret Decryption:** –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–ª—é—á–∏ S3 –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è –∏–∑ –ë–î.

### üí≥ Payments (`api/payment.js`)
*   **Webhook Handling:**
    *   –°–∏–º—É–ª—è—Ü–∏—è `payment.succeeded` –æ—Ç –ÆKassa.
    *   –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–µ–±—Ö—É–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –¥–≤–∞–∂–¥—ã).
    *   –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ (`lifetime` vs `pro`).

---

## 4. E2E –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (End-to-End)
*–¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—É—Ç–µ–π (Happy Path).*

### –°—Ü–µ–Ω–∞—Ä–∏–π "Onboarding & Upload"
1.  –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —é–∑–µ—Ä–∞ (Mock Clerk).
2.  –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ "Demo Project".
3.  –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ `.mp4` (Mock Upload).
4.  –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –≤ —Å–ø–∏—Å–∫–µ –∞—Å—Å–µ—Ç–æ–≤.

### –°—Ü–µ–Ω–∞—Ä–∏–π "Review Workflow"
1.  –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–ª–µ–µ—Ä–∞.
2.  –ö–ª–∏–∫ –ø–æ —Ç–∞–π–º–ª–∞–π–Ω—É -> –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.
3.  –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ -> –û—Ç–ø—Ä–∞–≤–∫–∞.
4.  –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Ç–∞–π–º–ª–∞–π–Ω–µ.

### –°—Ü–µ–Ω–∞—Ä–∏–π "Sharing"
1.  –í–ª–∞–¥–µ–ª–µ—Ü –≤–∫–ª—é—á–∞–µ—Ç "Public Access".
2.  –ö–æ–ø–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É.
3.  –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É –≤ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏).
4.  *Expect:* –ü—Ä–æ–µ–∫—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –≤–∏–¥–µ–æ –∏–≥—Ä–∞–µ—Ç, –∫–Ω–æ–ø–∫–∏ "Delete" —Å–∫—Ä—ã—Ç—ã.

---

## 5. –ú–µ–¥–∏–∞ –∏ –°—Ç—Ä–∏–º–∏–Ω–≥ QA (–°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è Anotee)
*–≠—Ç–∏ —Ç–µ—Å—Ç—ã —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤.*

### üé• Playback Reliability (–ñ–µ–ª–µ–∑–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞)
*   **Google Drive Link:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ URL –∏–º–µ–µ—Ç –≤–∏–¥ `drive.google.com/uc?export=download`.
*   **CORS Attribute:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ DevTools, —á—Ç–æ —É —Ç–µ–≥–∞ `<video>` **–ù–ï–¢** –∞—Ç—Ä–∏–±—É—Ç–∞ `crossOrigin="anonymous"` –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ —Å Drive. –ï—Å–ª–∏ –æ–Ω –µ—Å—Ç—å ‚Äî —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω.
*   **Range Requests:**
    *   –í DevTools Network –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤–∏–¥–µ–æ.
    *   –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `206 Partial Content`.
    *   –ï—Å–ª–∏ `200 OK` (–≤–µ—Å—å —Ñ–∞–π–ª) -> –¢–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω (—Å–∫—Ä–∞–±–±–∏–Ω–≥ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å).

### ‚òÅÔ∏è S3 (BYOS) Integration
*   **CORS Config:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ `Access-Control-Allow-Origin` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å –±–∞–∫–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
*   **Mime Types:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–∏–¥–µ–æ –æ—Ç–¥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `Content-Type: video/mp4`, –∏–Ω–∞—á–µ Safari –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ—Ç.

---

## 6. –†—É—á–Ω–æ–µ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (UX Checklist)

–ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ä–µ–ª–∏–∑–æ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

*   **Mobile Experience:**
    *   [ ] –°–≤–∞–π–ø –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ –ø–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é –≤ —Å–ø–∏—Å–∫–µ (Delete/Edit).
    *   [ ] –ü–ª–µ–µ—Ä –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –ø—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.
    *   [ ] –ì–∞–º–±—É—Ä–≥–µ—Ä-–º–µ–Ω—é –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
*   **Performance:**
    *   [ ] –°–∫—Ä–∞–±–±–∏–Ω–≥ –≤–∏–¥–µ–æ –º—ã—à–∫–æ–π ("Dead Zone" check). –í–∏–¥–µ–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –¥–µ—Ä–≥–∞—Ç—å—Å—è –ø—Ä–∏ –º–∏–∫—Ä–æ-–¥–≤–∏–∂–µ–Ω–∏—è—Ö.
    *   [ ] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π (v1 -> v2) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
*   **Optimistic UI:**
    *   [ ] –ü—Ä–∏ —Å–º–µ–Ω–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞.

---

## 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Security)

*   **Rate Limiting:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç DDOS –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö `/api/upload` –∏ `/api/data`.
*   **Data Isolation:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ `ownerId` –∏–ª–∏ `orgId`.
*   **Token Validation:** –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ API —Å –∏—Å—Ç–µ–∫—à–∏–º –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º JWT —Ç–æ–∫–µ–Ω–æ–º –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `401`.

---

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã (Future)

```bash
# Unit Tests
npm run test:unit

# E2E Tests (Headless)
npm run test:e2e

# Type Check
npm run typecheck
```
