
# ‚òÅÔ∏è Clerk Migration Plan (SmoTree)

–ü–ª–∞–Ω –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Clerk –¥–ª—è –æ—Ç–∫–∞–∑–∞ –æ—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∫–æ–¥–∞ ("–∫–æ—Å—Ç—ã–ª–µ–π").

## üö® –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Critical)
- [x] –í **Clerk Dashboard > Social Connections > Google** (–Ω–∞–∂–∞—Ç—å —à–µ—Å—Ç–µ—Ä–µ–Ω–∫—É ‚öôÔ∏è) –≤–∫–ª—é—á–∏—Ç—å –æ–ø—Ü–∏—é **"Use custom credentials"**.
- [x] –¢–∞–º –∂–µ –≤ –ø–æ–ª–µ **Scopes** –¥–æ–±–∞–≤–∏—Ç—å: `https://www.googleapis.com/auth/drive.file`.
    *   *–ó–∞—á–µ–º:* –ß—Ç–æ–±—ã –ø—Ä–∏ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Google —Å—Ä–∞–∑—É –≤—ã–¥–∞–≤–∞–ª–∏—Å—å –ø—Ä–∞–≤–∞ –Ω–∞ –î–∏—Å–∫, –∏ –Ω–µ –Ω—É–∂–Ω–∞ –±—ã–ª–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "Connect Drive" —Å —Ä—É—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç–æ–∫–µ–Ω–æ–≤.

---

## üì¶ –≠—Ç–∞–ø 1: –ü—Ä–æ—Ñ–∏–ª—å –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (UI/UX)
*–¶–µ–ª—å: –ó–∞–º–µ–Ω–∏—Ç—å `Profile.tsx` –∏ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π/—è–∑—ã–∫–æ–º.*

- [x] **UserProfile –ö–æ–º–ø–æ–Ω–µ–Ω—Ç**:
    - –í–Ω–µ–¥—Ä–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `<UserProfile />` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è.
    - –£–±—Ä–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é –≤–µ—Ä—Å—Ç–∫—É –∞–≤–∞—Ç–∞—Ä–∞ –∏ —Å–º–µ–Ω—ã –∏–º–µ–Ω–∏.
- [x] **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Settings)**:
    - –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `LanguageProvider` –∏ `ThemeProvider`.
    - –í–º–µ—Å—Ç–æ `localStorage`, —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –≤ `user.unsafeMetadata.settings` (–ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏).
- [x] **–ß–∏—Å—Ç–∫–∞**: –£–¥–∞–ª–∏—Ç—å –∫–æ–¥ —Ä—É—á–Ω–æ–≥–æ —Ä–µ—Ç—Ä–∞—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ `Profile.tsx` (Clerk SDK –¥–µ–ª–∞–µ—Ç —ç—Ç–æ —Å–∞–º, –µ—Å–ª–∏ —Å–∫–æ—É–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ –¥–∞—à–±–æ—Ä–¥–µ).

## üè¢ –≠—Ç–∞–ø 2: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (Teams)
*–¶–µ–ª—å: –ó–∞–º–µ–Ω–∏—Ç—å –º–∞—Å—Å–∏–≤ `team: []` –≤ JSON –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–µ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.*

- [ ] **–í–∫–ª—é—á–∏—Ç—å Organizations** –≤ Clerk Dashboard.
- [ ] **UI**: –î–æ–±–∞–≤–∏—Ç—å `<OrganizationSwitcher />` –≤ `AppHeader`.
- [ ] **–õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è**:
    - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å –µ–≥–æ –∫ `orgId` —Ç–µ–∫—É—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
- [ ] **–õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (–ë—ç–∫–µ–Ω–¥)**:
    - –í `api/data.js`: –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø –Ω–µ –ø–æ `project.team.includes(user)`, –∞ –ø–æ `auth.orgId`.
    - –ï—Å–ª–∏ `orgId` —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –¥–∞–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø.
- [ ] **–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è**:
    - –£–¥–∞–ª–∏—Ç—å `api/join.js`.
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `<OrganizationProfile />` –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∫–æ–ª–ª–µ–≥ –ø–æ Email.

## üîê –≠—Ç–∞–ø 3: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Security)
*–¶–µ–ª—å: –£–¥–∞–ª–∏—Ç—å —Å–∞–º–æ–ø–∏—Å–Ω—É—é –≥–æ—Å—Ç–µ–≤—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é.*

- [ ] **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ Guest Mode**:
    - –£–¥–∞–ª–∏—Ç—å `components/Login.tsx` (–∫–∞—Å—Ç–æ–º–Ω—É—é —Ñ–æ—Ä–º—É).
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `<SignIn />` –∏ `<SignUp />` –¥–ª—è –≤—Å–µ—Ö.
    - –î–ª—è "–±—ã—Å—Ç—Ä–æ–≥–æ" –≤—Ö–æ–¥–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å "Email Link" (–±–µ–∑ –ø–∞—Ä–æ–ª—è) –≤ Clerk.
- [ ] **API Cleanup**:
    - –£–¥–∞–ª–∏—Ç—å `api/guest.js`.
    - –í `api/_auth.js` —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É HMAC –ø–æ–¥–ø–∏—Å–µ–π. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `verifyToken`.

## üîÑ –≠—Ç–∞–ø 4: –ú–∏–≥—Ä–∞—Ü–∏—è –î–∞–Ω–Ω—ã—Ö
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç (–∏–ª–∏ API —Ä—É—á–∫—É) –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:
    - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `ownerId` (—Å—Ç–∞—Ä—ã–π) –≤ `createdBy` (–Ω–æ–≤—ã–π).
    - –ü—Ä–∏—Å–≤–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç–∞–º `orgId` (–õ–∏—á–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

---

## ‚úÖ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å?
1. –ó–∞–π–¥–∏—Ç–µ –≤ –ü—Ä–æ—Ñ–∏–ª—å (–∫–ª–∏–∫ –ø–æ –∞–≤–∞—Ç–∞—Ä–∫–µ). –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∏–¥–∂–µ—Ç Clerk.
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–º–µ–Ω–∏—Ç—å —Ç–µ–º—É (Dark/Light). –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äî —Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è.
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–º–µ–Ω–∏—Ç—å —è–∑—ã–∫. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äî —è–∑—ã–∫ –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è.
