
Ниже — diff‑план по файлам для явного и понятного отображения уровня тарифа и для юзера, и для админа.

Цель
Сделать единое, однозначное отображение тарифа (Free / Pro / Lifetime) во всех ключевых местах UI, чтобы:

пользователь всегда видел свой текущий уровень;

админ видел тот же уровень в списке пользователей и действиях;

не было “смешения” paid-статуса и конкретного плана.

Diff‑план по файлам
1) services/planLabels.ts (новый файл)
Что добавить

Единый маппер для отображения тарифа:

getPlanLabel(plan, locale) → Free / Pro / Lifetime

getPlanTone(plan) → классы/цвет бейджа

isPaidPlan(plan) (если нужно в UI)

(Опционально) getPlanDescription(plan) для подсказок.

Зачем
Сейчас текст/цвета размазаны по компонентам и могут расходиться.

2) hooks/useSubscription.ts
Что поменять

Ничего фундаментально не менять в вычислении плана (оно уже корректно разделяет free/pro/lifetime).

Опционально: экспортировать displayPlan через helper из services/planLabels.ts.

Почему
Хук уже отдает plan, isPro, isLifetime, isPaid. Это хорошая база для отображения. 

3) components/Profile.tsx (пользовательский экран — главный источник статуса)
Что поменять

Перевести все подписи блока подписки на plan, а не только isPro.

Исправить заголовок/текст:

сейчас h3 показывает "Подписка активна" только для isPro; lifetime визуально не всегда трактуется как активная подписка в заголовке.

Кнопку отмены автосписаний показывать только для plan === 'pro' && isAutoRenew.

Добавить маленький “тех.индикатор” (например: Текущий план: Lifetime) рядом со statusText, чтобы убрать двусмысленность.

Почему
Сейчас statusText уже есть, но часть логики блока завязана на isPro и формулировки могут быть нелогичны для lifetime. 

4) components/admin/AdminUsersTab.tsx (админка пользователей)
Что поменять

Вынести отображение статуса в единый PlanBadge (или helper-функцию) и использовать для desktop/mobile.

Переименовать действия:

Снять Pro → Сбросить до Free

Выдать Pro → Изменить план

В модалке выдачи:

текущий текст “Выдать Pro доступ” заменить на “Назначить план”

оставить 7/30/365/Lifetime, но явно подписать, какой план назначается.

Добавить отдельный фильтр/счетчик по Lifetime (сейчас есть объединенный paid-счетчик).

Почему
Сейчас статус в таблице есть, но action-тексты по смыслу “про Pro”, хотя реально назначается и lifetime. 

5) api/admin.js (контракты для админки)
Что поменять

Минимально: без breaking changes оставить grant_pro, но:

вернуть в ответе нормализованные поля (planAssigned, expiresAt, isLifetime).

Желательно: добавить новый action alias set_plan (принимает plan: free|pro|lifetime + срок для pro), а grant_pro оставить как backward-compatible alias.

Почему
Семантика API сейчас историческая (“grant_pro”), но фактически умеет выдавать lifetime. 

6) types.ts
Что поменять

Добавить общий тип UserPlan = 'free' | 'pro' | 'lifetime' в центральное место (если еще не используется глобально).

Привести AdminUser.plan и все связанные места к единому типу.

Почему
Тип уже фактически используется в интерфейсах, но стоит унифицировать переиспользование. 

7) (Опционально, UX) components/Dashboard.tsx / components/ProjectView.tsx
Что поменять

Добавить компактный PlanBadge в шапку экрана (виден юзеру сразу, без перехода в Profile).

Зачем
Пользователь мгновенно понимает свой уровень в рабочих экранах.

Что уже хорошо (не трогаем)
План на клиенте корректно разделяется на free/pro/lifetime. 

В админ users API план отдается явно (meta.plan || 'free'). 

Acceptance criteria (готовность)
На Profile у юзера всегда видно: текущий план и его человекочитаемое имя.

Для Lifetime нет misleading-текста “базовый тариф”.

В Admin Users и в действиях нет “Pro-only” формулировок там, где реально поддерживается Lifetime.

После изменения плана в админке бейдж меняется сразу и согласован с Profile.
*****
даю два варианта: минимальный (1 PR, без API-рефакторинга) и полный (2 PR: UI + API контракты).

Вариант A — “минимальный” план на 1 PR (только UI, API не ломаем)
Цель
Сделать отображение уровня тарифа понятным и единообразным для юзера и админа, не меняя backend-контракты (grant_pro, revoke_pro, users и т.д.). 

Scope PR
Новый UI-helper для плана

✅ **[В ПРОЦЕССЕ]** Добавить services/planLabels.ts:

getPlanLabel(plan) → FREE / PRO / LIFETIME

getPlanBadgeClass(plan) → единые стили бейджа

(опц.) getPlanTitle(plan) для заголовков в Profile.

Основание: план уже централизованно существует как free|pro|lifetime. 

Profile: привести блок подписки к 3-плановой логике

✅ **[В ПРОЦЕССЕ]** Заменить двоичные формулировки (isPro ? ... : ...) на плановые (plan).

Исправить:

заголовок: не показывать lifetime как “базовый тариф”;

CTA “Обновиться” показывать только для free;

“Отменить подписку” — только для plan==='pro' && isAutoRenew.

Сейчас место, где это нужно поправить: блок с statusText, h3, CTA и cancel-link. 

AdminUsersTab: унифицировать статусы и действия

✅ **[В ПРОЦЕССЕ]** Вынести рендер статуса в единый PlanBadge (или helper).

Тексты действий:

Снять Pro → Сбросить до Free

Выдать Pro → Изменить план

В модалке “Выдать Pro доступ” → “Назначить план”.

Основание: сейчас UI уже отличает LIFETIME/PRO, но wording исторически “про Pro”. 

(Опц.) Dashboard/ProjectView: маленький plan badge в header

Только визуал, без изменения логики доступа.

Acceptance criteria (1 PR)
В Profile корректный текст для free/pro/lifetime.

Админ в таблице и модалке видит те же названия уровней, что и юзер.

Нигде нет misleading-текста “Pro”, когда по факту назначается lifetime.

Вариант B — “полный” план на 2 PR (UI + API контракты)
PR-1: UI консистентность (всё из минимального плана)
Точно как в варианте A, без backend-breaking изменений.

PR-2: API контракты и терминология (эволюционно, с backward compatibility)
Цель
Сделать серверные контракты явными для 3-плановой модели и убрать неоднозначность названия grant_pro.

Scope PR-2
Новый action в api/admin.js

Добавить action=set_plan:

body: { userId, plan: 'free'|'pro'|'lifetime', days? }

Ответ:

{ success, userId, planAssigned, expiresAt, isAutoRenew }

При этом оставить grant_pro как alias (deprecated), чтобы текущий UI не падал. 

Нормализация ответа action=users

Дополнить payload вычисленными полями:

planLabel, isPaidPlan, isRecurringEligible.

Сейчас уже приходит plan, expiresAt, isAutoRenew — это база для расширения. 

AdminUsersTab переключить на set_plan

Модалка: явный выбор плана (Free/Pro/Lifetime), для Pro — длительность.

Кнопки действий приводим к нейтральным (“Изменить план”, “Сбросить план”).

Логи/аудит

В логи писать set_plan с previousPlan -> newPlan (минимальный audit trail).

Acceptance criteria (PR-2)
API явно отражает 3-плановую модель.

UI не зависит от legacy-терминов grant_pro.

Старые клиенты продолжают работать через alias.

Рекомендуемая последовательность
Сначала PR-1 (UI only) — быстро, безопасно, сразу улучшает UX.

Затем PR-2 (API contracts) — аккуратная миграция без ломки.

Что уже готово в базе (почему это легко внедрять)
useSubscription уже отдает plan/isPaid/isLifetime. 

В админ-данных уже есть plan на пользователя. 

Тип AdminUser.plan уже 3-уровневый.
