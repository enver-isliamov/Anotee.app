
# üöú SmoTree Refactoring Roadmap

## üìã –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π

## üöÄ –≠—Ç–∞–ø VII: SaaS –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Contextual Permissions)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üöë –≠—Ç–∞–ø VIII: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –û—á–∏—Å—Ç–∫–∞ (Security Cleanup)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üõë –≠—Ç–∞–ø IX: Critical Refactoring & Bug Fixes (–ó–∞–≤–µ—Ä—à–µ–Ω)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

----

## üíÄ –≠—Ç–∞–ø X: Technical Debt & Critical Fixes (–¢–µ–∫—É—â–∏–π)
**–°—Ç–∞—Ç—É—Å:** üöß **–í —Ä–∞–±–æ—Ç–µ**

–í—ã—è–≤–ª–µ–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–µ—Å—Ç—ã–∫–æ–≤–∫–∏, –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ —Ä–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

### 1. üö® –ü–æ—á–∏–Ω–∫–∞ –®–µ—Ä–∏–Ω–≥–∞ –≤ –õ–∏—á–Ω–æ–º –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (The Invite Trap)
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** –í Personal Workspace –∫–Ω–æ–ø–∫–∞ "Copy Link" –¥–∞–µ—Ç —Å—Å—ã–ª–∫—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —É –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–ë—ç–∫–µ–Ω–¥ —Ç—Ä–µ–±—É–µ—Ç –±—ã—Ç—å –≤ `team`, –Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ `team` –Ω–µ—Ç).
- [ ] **–†–µ—à–µ–Ω–∏–µ:** 
    - –î–æ–±–∞–≤–∏—Ç—å –≤ `Project` –ø–æ–ª–µ `publicAccess: 'view' | 'none'`.
    - –í UI `ProjectView` –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "Anyone with link can View" (–¥–ª—è –õ–∏—á–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤).
    - –û–±–Ω–æ–≤–∏—Ç—å `api/data.js` (GET), —á—Ç–æ–±—ã –æ—Ç–¥–∞–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã —Å `publicAccess: 'view'` –¥–∞–∂–µ –µ—Å–ª–∏ —é–∑–µ—Ä–∞ –Ω–µ—Ç –≤ `team`.

### 2. ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (Heavy Payload)
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `forceSync` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Å—å –º–∞—Å—Å–∏–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤. –ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ç–∞–π–º–∞—É—Ç–∞–º –∏ –±–∞–≥–∞–º.
- [ ] **–†–µ—à–µ–Ω–∏–µ:**
    - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `App.tsx`: `handleAddProject` –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω** –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç.
    - `handleUpdateProject` –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PATCH` –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ ID, –∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å—ë.

### 3. üõ°Ô∏è –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ü–æ–ª–ª–∏–Ω–≥–∞ (UX Jitter)
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª–ª–∏–Ω–≥ (10—Å) –≤—ã–∑—ã–≤–∞–µ—Ç –∂–µ—Å—Ç–∫–∏–π —Ä–µ-—Ä–µ–Ω–¥–µ—Ä, —Å–±–∏–≤–∞—è –∫—É—Ä—Å–æ—Ä—ã –∏ –∏–Ω–ø—É—Ç—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –º–µ–Ω—è–ª–∏—Å—å.
- [ ] **–†–µ—à–µ–Ω–∏–µ:**
    - –í `fetchCloudData` —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ö–µ—à –∏–ª–∏ `updatedAt` –ø—Ä–∏—à–µ–¥—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏.
    - –í—ã–∑—ã–≤–∞—Ç—å `setProjects` —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

### 4. üßπ –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–µ–∫—Ç—ã –≤ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö –¥—É–±–ª–∏—Ä—É—é—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –º–∞—Å—Å–∏–≤ `team` JSON-–∞.
- [ ] **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Org –æ—Å—Ç–∞–≤–ª—è—Ç—å `team: []` –ø—É—Å—Ç—ã–º. –ü–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ `orgId`.

### 5. üóëÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "–°–∏—Ä–æ—Ç–∞–º–∏" (Orphaned Files)
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–ª–∞, –∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —É–ø–∞–ª–æ ‚Äî —Ñ–∞–π–ª –≤–∏—Å–∏—Ç –≤ Vercel Blob –∏ –µ—Å—Ç –ª–∏–º–∏—Ç—ã.
- [ ] **–†–µ—à–µ–Ω–∏–µ:** –í `useUploadManager` –¥–æ–±–∞–≤–∏—Ç—å `try/catch`: –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ —É–ø–∞–ª–æ -> –≤—ã–∑–≤–∞—Ç—å `api.deleteAssets` –¥–ª—è —Å–≤–µ–∂–µ–∑–∞–ª–∏—Ç–æ–≥–æ —Ñ–∞–π–ª–∞.

### 6. üåê –£–ª—É—á—à–µ–Ω–∏–µ UI
- [ ] **–ó–∞–¥–∞—á–∞:** –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É "Legacy Data Recovery" –≤ –ø—Ä–æ—Ñ–∏–ª–µ, –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –±—ã–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –∏–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞.
