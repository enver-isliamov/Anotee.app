
# üöú SmoTree Refactoring Roadmap

## üìã –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π

## üöÄ –≠—Ç–∞–ø VII: SaaS –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Contextual Permissions)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üöë –≠—Ç–∞–ø VIII: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –û—á–∏—Å—Ç–∫–∞ (Security Cleanup)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üõë –≠—Ç–∞–ø IX: Critical Refactoring & Bug Fixes (–ó–∞–≤–µ—Ä—à–µ–Ω)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üíÄ –≠—Ç–∞–ø X: Technical Debt & Critical Fixes (–ó–∞–≤–µ—Ä—à–µ–Ω)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üßπ –≠—Ç–∞–ø XI: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –î—ã—Ä
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

---

## üõ°Ô∏è –≠—Ç–∞–ø XII: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–¢–µ–∫—É—â–∏–π)
**–°—Ç–∞—Ç—É—Å:** üöß **–ö –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é**

–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö "–º–∏–Ω –∑–∞–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è", –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –∞—É–¥–∏—Ç–µ.

### 1. üî• Critical Security: SSRF –≤ Proxy Audio
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `api/proxyAudio.js` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç URL –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ `.includes('drive.google.com')`. –≠—Ç–æ —É—è–∑–≤–∏–º–æ –¥–ª—è SSRF –∞—Ç–∞–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –ø–æ–¥–¥–æ–º–µ–Ω—ã –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è).
- [ ] **–ó–∞–¥–∞—á–∞:** –í–Ω–µ–¥—Ä–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é Regex-–≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è Google Drive File ID –∏ –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞—Ç—å URL API –∂–µ—Å—Ç–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–µ—Ä–∞, –Ω–µ –¥–æ–≤–µ—Ä—è—è `req.query.url` —Ü–µ–ª–∏–∫–æ–º.

### 2. üí£ Timebomb: Out-Of-Memory –≤ –ú–∏–≥—Ä–∞—Ü–∏–∏
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `api/migrate.js` –¥–µ–ª–∞–µ—Ç `SELECT *` –±–µ–∑ `LIMIT`. –ü—Ä–∏ —Ä–æ—Å—Ç–µ –ë–î —Å–∫—Ä–∏–ø—Ç —É–ø–∞–¥–µ—Ç –ø–æ –ø–∞–º—è—Ç–∏ (Lambda OOM).
- [ ] **–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ Batch-–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ (Cursor-based pagination) –∏–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ 50 –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑.

### 3. üìâ Performance: "–¢—è–∂–µ–ª—ã–π" –ü–æ–ª–ª–∏–Ω–≥
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `App.tsx` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π JSON –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥. –≠—Ç–æ —É–±–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã Vercel Postgres –∏ —Ç—Ä–∞—Ñ–∏–∫.
- [ ] **–ó–∞–¥–∞—á–∞:** 
    - –°–æ–∑–¥–∞—Ç—å –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `HEAD /api/data` –∏–ª–∏ `/api/check-updates`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π `Last-Modified` timestamp.
    - –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ timestamp –∏–∑–º–µ–Ω–∏–ª—Å—è.

### 4. üß© Inconsistency: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è User Object
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `api/upload.js` —Å–æ–∑–¥–∞–µ—Ç user-–æ–±—ä–µ–∫—Ç –≤—Ä—É—á–Ω—É—é (`{id: sub}`), –∞ `api/data.js` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `verifyUser`. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Ä–∏—Å–∫, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ `checkProjectAccess` —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É –≤ —Ä–∞–∑–Ω—ã—Ö API.
- [ ] **–ó–∞–¥–∞—á–∞:** –í—ã–Ω–µ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏–µ user-–æ–±—ä–µ–∫—Ç–∞ –∏–∑ —Ç–æ–∫–µ–Ω–∞ –≤ –µ–¥–∏–Ω—É—é —É—Ç–∏–ª–∏—Ç—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –≤ `upload.js` (—á–µ—Ä–µ–∑ `onBeforeGenerateToken`).

### 5. üèóÔ∏è Refactor: –£–¥–∞–ª–µ–Ω–∏–µ Event Bus "–ö–æ—Å—Ç—ã–ª–µ–π"
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Google Drive –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `window.dispatchEvent` –≤ `ProjectView`. –≠—Ç–æ React –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω.
- [ ] **–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `isDriveReady` –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π Context –∏–ª–∏ Zustand Store.
