
# üöú SmoTree Refactoring Roadmap

## üìã –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π

## üöÄ –≠—Ç–∞–ø VII: SaaS –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Contextual Permissions)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üöë –≠—Ç–∞–ø VIII: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –û—á–∏—Å—Ç–∫–∞ (Security Cleanup)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

---

## üõë –≠—Ç–∞–ø IX: Critical Refactoring & Bug Fixes (–ó–∞–≤–µ—Ä—à–µ–Ω)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –î–∞–Ω–Ω—ã–µ
- [x] **Split-Brain Problem (Team Data):**
    - *–†–µ—à–µ–Ω–∏–µ:* `ProjectView` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `useOrganization` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- [x] **Optimistic Locking Conflicts:**
    - *–†–µ—à–µ–Ω–∏–µ:* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `PATCH /api/data` –¥–ª—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ `Smart Merge` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (AI & Media)
- [x] **AI Memory Leak (Browser Crash):**
    - *–†–µ—à–µ–Ω–∏–µ:* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω **Safety Guard** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞, –ª–∏–º–∏—Ç 300MB) –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ AudioContext.
- [x] **Thumbnail Generation CORS:**
    - *–†–µ—à–µ–Ω–∏–µ:* –î–æ–±–∞–≤–ª–µ–Ω `crossOrigin="anonymous"` –∏ **Smart Fallback** (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–ª—É—à–∫–∏ –Ω–∞ Canvas).

### 3. Google Drive Integration
- [x] **Playback Reliability:**
    - *–°—É—Ç—å:* –û—à–∏–±–∫–∏ 403 –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≤–∏–¥–µ–æ —Å Drive.
    - *–†–µ—à–µ–Ω–∏–µ:* –í–Ω–µ–¥—Ä–µ–Ω –º–µ—Ç–æ–¥ `getAuthenticatedStreamUrl`, –∫–æ—Ç–æ—Ä—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç OAuth token –∫ URL –ø–æ—Ç–æ–∫–∞ (Client-side proxying), –∏–∑–±–µ–≥–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

- [x] **Upload Permission Fail:**
    - *–°—É—Ç—å:* –ü–æ–ª–∏—Ç–∏–∫–∏ Google Workspace –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.
    - *–†–µ—à–µ–Ω–∏–µ:*
        1. –í–Ω–µ–¥—Ä–µ–Ω `safe-fail` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –µ—Å–ª–∏ –ø—Ä–∞–≤–∞ –Ω–µ –≤—ã—Å—Ç–∞–≤–ª—è—é—Ç—Å—è, –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –ø–∞–¥–∞–µ—Ç.
        2. –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `Fix Permissions` (–∫–Ω–æ–ø–∫–∞ —Å –∑–∞–º–∫–æ–º) –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –≤—Ä—É—á–Ω—É—é –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –∏–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É.

### 4. Code Quality & Cleanup
- [x] **App.tsx Bloat:** –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ —Ö—É–∫ `useUploadManager`.
- [x] **Legacy Types:** –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `role` –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `User`.
- [x] **API Consistency:** `api/comment.js` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ `orgId` –∏ Clerk API.
- [x] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Clerk:** 
    - –£–¥–∞–ª–µ–Ω `guest.js`, `join.js`.
    - –û—á–∏—â–µ–Ω `apiClient.ts` –æ—Ç –≥–æ—Å—Ç–µ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤.
    - –ü—Ä–æ–≤–µ–¥–µ–Ω –∞—É–¥–∏—Ç –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `verifyUser`.
