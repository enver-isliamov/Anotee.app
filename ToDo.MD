
# üöú SmoTree Refactoring Roadmap

## üìã –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π

## üöÄ –≠—Ç–∞–ø VII: SaaS –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Contextual Permissions)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üöë –≠—Ç–∞–ø VIII: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –û—á–∏—Å—Ç–∫–∞ (Security Cleanup)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üõë –≠—Ç–∞–ø IX: Critical Refactoring & Bug Fixes (–ó–∞–≤–µ—Ä—à–µ–Ω)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

---

## üíÄ –≠—Ç–∞–ø X: Technical Debt & Critical Fixes (–¢–µ–∫—É—â–∏–π)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω**

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

### 1. üö® –ü–æ—á–∏–Ω–∫–∞ –®–µ—Ä–∏–Ω–≥–∞ –≤ –õ–∏—á–Ω–æ–º –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (The Invite Trap)
- [x] **–ü—Ä–æ–±–ª–µ–º–∞:** –í Personal Workspace –∫–Ω–æ–ø–∫–∞ "Copy Link" –¥–∞–µ—Ç —Å—Å—ã–ª–∫—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —É –ø–æ–ª—É—á–∞—Ç–µ–ª—è.
- [x] **–†–µ—à–µ–Ω–∏–µ:** 
    - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `publicAccess: 'view' | 'none'`.
    - –í UI `ProjectView` –¥–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "Public Access".
    - API `api/data.js` (GET) —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `projectId` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç, –µ—Å–ª–∏ –æ–Ω –ø—É–±–ª–∏—á–Ω—ã–π.

### 2. ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (Heavy Payload)
- [x] **–ü—Ä–æ–±–ª–µ–º–∞:** `forceSync` –æ—Ç–ø—Ä–∞–≤–ª—è–ª –≤–µ—Å—å –º–∞—Å—Å–∏–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤.
- [x] **–†–µ—à–µ–Ω–∏–µ:**
    - `App.tsx`: `handleAddProject` –∏ `handleUpdateProject` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞—é—Ç `forceSync([updatedProject])` (–º–∞—Å—Å–∏–≤ –∏–∑ 1 —ç–ª–µ–º–µ–Ω—Ç–∞).
    - API POST –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∞—Å—Å–∏–≤, –æ–±–Ω–æ–≤–ª—è—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ ID.

### 3. üõ°Ô∏è –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ü–æ–ª–ª–∏–Ω–≥–∞ (UX Jitter)
- [x] **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª–ª–∏–Ω–≥ –≤—ã–∑—ã–≤–∞–ª –∂–µ—Å—Ç–∫–∏–π —Ä–µ-—Ä–µ–Ω–¥–µ—Ä.
- [x] **–†–µ—à–µ–Ω–∏–µ:**
    - –í `fetchCloudData` –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö–µ—à–µ–π (ID + Version) –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `setProjects`.

### 4. üßπ –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- [x] **–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `team`.
- [x] **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Org –º–∞—Å—Å–∏–≤ `team` —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—É—Å—Ç—ã–º.

### 5. üóëÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "–°–∏—Ä–æ—Ç–∞–º–∏" (Orphaned Files)
- [x] **–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ Blob –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ë–î.
- [x] **–†–µ—à–µ–Ω–∏–µ:** –í `useUploadManager` –¥–æ–±–∞–≤–ª–µ–Ω `try/catch` —Å –≤—ã–∑–æ–≤–æ–º `api.deleteAssets` –ø—Ä–∏ —Å–±–æ–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

### 6. üåê –£–ª—É—á—à–µ–Ω–∏–µ UI
- [x] **–ó–∞–¥–∞—á–∞:** –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É "Legacy Data Recovery" –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.
- [x] **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `user.unsafeMetadata.migrated` –≤ `Profile.tsx`.
