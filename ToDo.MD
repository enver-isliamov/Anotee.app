
# üöú SmoTree Refactoring Roadmap

## üìã –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π

## üöÄ –≠—Ç–∞–ø VII: SaaS –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Contextual Permissions)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üöë –≠—Ç–∞–ø VIII: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –û—á–∏—Å—Ç–∫–∞ (Security Cleanup)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

---

## üõë –≠—Ç–∞–ø IX: Critical Refactoring & Bug Fixes (–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å)
**–°—Ç–∞—Ç—É—Å:** üöß **–í —Ä–∞–±–æ—Ç–µ**

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –î–∞–Ω–Ω—ã–µ
- [x] **Split-Brain Problem (Team Data):**
    - *–†–µ—à–µ–Ω–∏–µ:* `ProjectView` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `useOrganization` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- [x] **Optimistic Locking Conflicts:**
    - *–†–µ—à–µ–Ω–∏–µ:* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `PATCH /api/data` –¥–ª—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ `Smart Merge` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (AI & Media)
- [x] **AI Memory Leak (Browser Crash):**
    - *–†–µ—à–µ–Ω–∏–µ:* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω **Safety Guard** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞, –ª–∏–º–∏—Ç 300MB) –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ AudioContext.
- [x] **Thumbnail Generation CORS:**
    - *–†–µ—à–µ–Ω–∏–µ:* –î–æ–±–∞–≤–ª–µ–Ω `crossOrigin="anonymous"` –∏ **Smart Fallback** (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–ª—É—à–∫–∏ –Ω–∞ Canvas).

### 3. Google Drive Integration
- [x] **Playback Reliability:**
    - *–°—É—Ç—å:* –û—à–∏–±–∫–∏ 403 –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≤–∏–¥–µ–æ —Å Drive.
    - *–†–µ—à–µ–Ω–∏–µ:* –í–Ω–µ–¥—Ä–µ–Ω –º–µ—Ç–æ–¥ `getAuthenticatedStreamUrl`, –∫–æ—Ç–æ—Ä—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç OAuth token –∫ URL –ø–æ—Ç–æ–∫–∞ (Client-side proxying), –∏–∑–±–µ–≥–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

- [ ] **Upload Permission Fail:**
    - *–°—É—Ç—å:* `GoogleDriveService` –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ `anyone/reader`. –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ Google Workspace —á–∞—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É—é—Ç —ç—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏.
    - *–°–∏–º–ø—Ç–æ–º:* –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –Ω–æ –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —á–µ—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω.

### 4. Code Quality & Cleanup
- [x] **App.tsx Bloat:** –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ —Ö—É–∫ `useUploadManager`.
- [x] **Legacy Types:** –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `role` –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `User`.
- [x] **API Consistency:** `api/comment.js` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ `orgId` –∏ Clerk API.
- [ ] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Clerk** –°–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≥–æ —á—Ç–æ –µ—â–µ –Ω–µ –±–≤–ª–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ Clerk —Å –ø–æ–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∏ —à–∞–≥–∞–º–∏ —Ä–∞–µ–ª–∏–∑–∞—Ü–∏–∏.
