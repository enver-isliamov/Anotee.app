
# üöú SmoTree Refactoring Roadmap

## üìã –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π

## üöÄ –≠—Ç–∞–ø VII: SaaS –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Contextual Permissions)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üöë –≠—Ç–∞–ø VIII: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –û—á–∏—Å—Ç–∫–∞ (Security Cleanup)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üõë –≠—Ç–∞–ø IX: Critical Refactoring & Bug Fixes (–ó–∞–≤–µ—Ä—à–µ–Ω)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üíÄ –≠—Ç–∞–ø X: Technical Debt & Critical Fixes (–ó–∞–≤–µ—Ä—à–µ–Ω)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üßπ –≠—Ç–∞–ø XI: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –î—ã—Ä
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

## üõ°Ô∏è –≠—Ç–∞–ø XII: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–≠—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω.**

---

## ü©π –≠—Ç–∞–ø XIII: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ä–æ–≤–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤ (–¢–µ–∫—É—â–∏–π)
**–°—Ç–∞—Ç—É—Å:** üöß **–í –æ–∂–∏–¥–∞–Ω–∏–∏**

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –ª–æ–≥–∏–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –≥–ª—É–±–æ–∫–æ–º –∞—É–¥–∏—Ç–µ –∫–æ–¥–∞.

### 1. üß≠ Broken Browser Navigation (History API)
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `history.pushState`, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª—å `window.addEventListener('popstate')`. –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤ –±—Ä–∞—É–∑–µ—Ä–µ –º–µ–Ω—è–µ—Ç URL, –Ω–æ –Ω–µ –º–µ–Ω—è–µ—Ç View –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- [ ] **–ó–∞–¥–∞—á–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥ –∏–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É `popstate` –≤ `App.tsx`.

### 2. üÜî Identity Consistency (Email vs Clerk ID)
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `api/_auth.js` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `id` –∫–∞–∫ Email –¥–ª—è –ª–µ–≥–∞—Å–∏-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –¥—ã—Ä—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
- [ ] **–ó–∞–¥–∞—á–∞:**
    - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `clerk_user_id` –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–µ–∑–¥–µ.
    - –û–±–Ω–æ–≤–∏—Ç—å `api/data.js` –∏ `api/upload.js`, —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ–ª–∞–≥–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ `userId`.
    - –û–±–Ω–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ç–æ—Ä, —á—Ç–æ–±—ã –æ–Ω –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª —Å—Ç–∞—Ä—ã–µ Email-based ID –≤ Clerk ID –≤ –º–∞—Å—Å–∏–≤–∞—Ö `team` (–µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è).

### 3. üßü Zombie Permissions (Team Array vs Org)
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `api/_permissions.js` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞—Å—Å–∏–≤ `team` –≤–Ω—É—Ç—Ä–∏ JSON –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
- [ ] **–ó–∞–¥–∞—á–∞:** –ï—Å–ª–∏ —É –ø—Ä–æ–µ–∫—Ç–∞ –µ—Å—Ç—å `org_id`, –º–∞—Å—Å–∏–≤ `data.team` –¥–æ–ª–∂–µ–Ω **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è** –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–∞–≤. –ü—Ä–∞–≤–∞ –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Clerk Organization Memberships.

### 4. ‚ö° Player Performance (Re-renders)
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `currentTime` –≤ `Player.tsx` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É, –≤—ã–∑—ã–≤–∞—è —Ä–µ-—Ä–µ–Ω–¥–µ—Ä –≤—Å–µ–≥–æ –¥–µ—Ä–µ–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤).
- [ ] **–ó–∞–¥–∞—á–∞:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `Player.tsx`, –≤—ã–Ω–µ—Å—è `Timeline` –∏ `TimeDisplay` –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ref –¥–ª—è –ø—Ä—è–º—ã—Ö DOM-–º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞.

### 5. üëª Ghost Local Files
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** `blob:` —Å—Å—ã–ª–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å—Ç–µ–π—Ç, –Ω–æ —É–º–∏—Ä–∞—é—Ç –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5).
- [ ] **–ó–∞–¥–∞—á–∞:** –í `App.tsx` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (init) —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –≤—Å–µ `localFileUrl` –≤ `undefined`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∫—Ä–æ–º–µ Mock Mode).

### 6. üîí Private Drive Files UI
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ Google Drive —Ñ–∞–π–ª –∏–º–µ–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ "Restricted", –ø–ª–µ–µ—Ä –ø—Ä–æ—Å—Ç–æ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π.
- [ ] **–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏ 403 –æ—Ç Drive Proxy –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "Fix Permissions" (–ø–æ–ø—ã—Ç–∫–∞ —Å–¥–µ–ª–∞—Ç—å —Ñ–∞–π–ª –ø—É–±–ª–∏—á–Ω—ã–º) –ø—Ä—è–º–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –æ—à–∏–±–∫–∏ –ø–ª–µ–µ—Ä–∞ (–¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞).
